@model IEnumerable<TL4_SHOP.Data.SanPham>
@{
    ViewData["Title"] = "Quản lý sản phẩm - 4TL";
    Layout = "~/Views/Shared/Layout_Admin.cshtml";
}
<!-- Sửa lại phần CSS và font -->
<link rel="stylesheet" href="~/css/admin.css" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<style>
    /* Override font cho admin page */
    .admin-container {
        font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .admin-header h1 {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
    }
    
    .stats-card {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border: 1px solid #e9ecef;
    }
    
    .stats-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
        color: #007bff;
    }
    
    .product-image {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
    }
    
    .product-name {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 4px;
    }
    
    .product-id {
        font-size: 0.85em;
        color: #6c757d;
    }
    
    .product-price {
        font-weight: 600;
        color: #28a745;
        font-size: 1.1em;
    }
    
    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: 500;
    }
    
    .status-active {
        background-color: #d4edda;
        color: #155724;
    }
    
    .status-warning {
        background-color: #fff3cd;
        color: #856404;
    }
    
    .status-inactive {
        background-color: #f8d7da;
        color: #721c24;
    }
    
    .action-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 35px;
        height: 35px;
        border-radius: 6px;
        margin: 0 2px;
        text-decoration: none;
        transition: all 0.3s ease;
    }
    
    .btn-view {
        background-color: #17a2b8;
        color: white;
    }
    
    .btn-edit {
        background-color: #ffc107;
        color: #212529;
    }
    
    .btn-delete {
        background-color: #dc3545;
        color: white;
    }
    
    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    /* Live search styles */
    .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        border-radius: 0 0 8px 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .suggestion-item {
        padding: 12px 15px;
        cursor: pointer;
        border-bottom: 1px solid #eee;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .suggestion-item:hover {
        background-color: #f8f9fa;
    }
    
    .suggestion-item img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 4px;
    }
    
    .suggestion-info h6 {
        margin: 0;
        font-size: 14px;
        font-weight: 500;
    }
    
    .suggestion-info p {
        margin: 0;
        font-size: 12px;
        color: #6c757d;
    }
</style>

<head>
  <meta charset="UTF-8">
  <title>Sidebar Thu Gọn</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    /* Sidebar mặc định */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 250px;
      background-color: #2c3e50;
      color: white;
      padding-top: 20px;
      transition: left 0.3s ease;
      z-index: 999;
    }

    /* Khi ẩn sidebar */
    .sidebar.hidden {
      left: -250px;
    }

    .sidebar a {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: white;
      text-decoration: none;
    }

    .sidebar a:hover {
      background-color: #34495e;
    }

    .sidebar a i {
      margin-right: 10px;
    }

    /* Nút toggle (☰) */
    .toggle-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background-color: #2980b9;
      color: white;
      padding: 10px 15px;
      font-size: 20px;
      border: none;
      cursor: pointer;
      z-index: 1000;
      border-radius: 4px;
    }

    .toggle-btn:hover {
      background-color: #1c638f;
    }

    /* Nội dung chính */
    .content {
      margin-left: 20px;
      padding: 20px;
    }

    /* Khi sidebar đang hiện, dịch nội dung chính sang phải */
    .sidebar-shown .content {
      margin-left: 270px;
      transition: margin 0.3s;
    }

    /* Vô hiệu hóa mục sidebar */
    .disabled-link {
      pointer-events: none;       /* Không cho click */
      opacity: 0.4;               /* Làm mờ */
      cursor: not-allowed;        /* Hiển thị dấu cấm */
    }

    /* Làm mờ icon */
    .disabled-link i {
      color: #7f8c8d !important;
    }

  </style>

  <!--Thanh cuộn-->
</head>
<body>

  <!-- Nút toggle -->
  <button class="toggle-btn" onclick="toggleSidebar()">☰</button>

  <!-- Sidebar -->
   <div class="sidebar hidden" id="sidebar">
      <div style="margin-top: 60px">
        <a asp-action="Index" asp-controller="Admin"><i class="fas fa-home disabled-link"></i> Home</a>
        <a asp-action="Index" asp-controller="QuanLySanPham"><i class="fas fa-box" style="color: orange"></i> Quản lý sản phẩm</a>
        <a asp-action="Index" asp-controller="NhapHang"><i class="fas fa-truck-loading" style="color: orange"></i> Nhập hàng</a>
        <a asp-action="Index" asp-controller="NhaCungCap"><i class="fas fa-truck" style="color: orange"></i> Nhà cung cấp</a>
        <a asp-action="Index" asp-controller="ChamSocKhachHang"><i class="fas fa-headset disabled-link"></i> Chăm sóc khách hàng</a>
        <a href="#"><i class="fas fa-shopping-cart disabled-link"></i> Đơn hàng</a>
        <a href="#"><i class="fas fa-box disabled-link"></i> Quản lý đơn hàng</a>
        <a asp-action="ThongKeDoanhThu" asp-controller="ThongKeDoanhThu"><i class="fas fa-chart-bar disabled-link"></i>Thống kê doanh thu</a>
        <a asp-action="QuanLyNhanVien" asp-controller="QuanLyNhanVien"><i class="fas fa-users-cog disabled-link"></i>Quản lý nhân viên</a>
         <a asp-action="KhachHang" asp-controller="KhachHang"><i class="fas fa-user-friends disabled-link"></i>Khách hàng</a>
      </div>
  </div>

  <!-- Nội dung chính -->
  <div class="content" id="mainContent">
    <h1>Chào mừng đến trang quản lý sản phẩm</h1>
  </div>

  <!-- JavaScript Toggle -->
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById("sidebar");
      const content = document.getElementById("mainContent");
      sidebar.classList.toggle("hidden");
      document.body.classList.toggle("sidebar-shown");
    }
  </script>
</body>


<div class="admin-container">
    <div class="container-fluid px-xl-5">
        <!-- Admin Header -->
        <div class="admin-header text-center mb-4">
            <div class="container">
                <h1><i class="fas fa-box me-3"></i> Quản lý sản phẩm</h1>
                <p>Hệ thống quản lý toàn bộ sản phẩm trong cửa hàng 4TL Shop</p>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4 text-nowrap">
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="stats-card text-center">
                    <i class="fas fa-box stats-icon"></i>
                    <h3>@(Model?.Count() ?? 0)</h3>
                    <p>Tổng sản phẩm</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="stats-card text-center">
                    <i class="fas fa-check-circle stats-icon text-success"></i>
                    <h3>@(Model?.Count(p => p.SoLuongTon > 0) ?? 0)</h3>
                    <p>Còn hàng</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="stats-card text-center">
                    <i class="fas fa-exclamation-triangle stats-icon text-warning"></i>
                    <h3>@(Model?.Count(p => p.SoLuongTon <= 5 && p.SoLuongTon > 0) ?? 0)</h3>
                    <p>Sắp hết hàng</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="stats-card text-center">
                    <i class="fas fa-times-circle stats-icon text-danger"></i>
                    <h3>@(Model?.Count(p => p.SoLuongTon == 0) ?? 0)</h3>
                    <p>Hết hàng</p>
                </div>
            </div>
        </div>

        <!-- Action Section -->
        <div class="action-section mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <h5><i class="fas fa-tools me-2"></i> Thao tác nhanh</h5>
                <div>
                    <a asp-action="Create" class="btn btn-success" style="border-radius: 100px">
                        <i class="fas fa-plus me-2"></i> Thêm sản phẩm
                    </a>
                    <button style="border-radius: 100px" class="btn btn-info" onclick="exportToExcel()">
                        <i class="fas fa-file-excel me-2"></i> Xuất Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Search and Filter Section với Live Search -->
        <div class="search-filter-section mb-4">
            <h5><i class="fas fa-search me-2"></i> Tìm kiếm & Lọc</h5>
            <form method="get" asp-action="Index" id="filterForm">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Tìm kiếm sản phẩm</label>
                        <div class="position-relative">
                            <input type="text" class="form-control" name="searchTerm" id="smartSearchInput" 
                                   placeholder="Nhập tên sản phẩm..." value="@ViewBag.SearchTerm" autocomplete="off">
                            <div id="searchSuggestions" class="search-suggestions"></div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Danh mục</label>
                        @Html.DropDownList("categoryId",
                                 ViewBag.DanhMucs as SelectList,
                                 "Tất cả danh mục",
                                 new { @class = "form-select", id = "categoryFilter"})
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Trạng thái kho</label>
                        @Html.DropDownList("stockStatus",
                                 ViewBag.StockStatusList as SelectList,
                                 new { @class = "form-select", id = "stockFilter" })
                    </div>
                    <div class="col-md-2 mb-3">
                        <label class="form-label">&nbsp;</label>
                        <button type="submit" class="btn btn-primary w-100" style="border-radius: 100px">
                            <i class="fas fa-filter me-1"></i> Lọc
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <a href="@Url.Action("Index")" class="btn btn-secondary" style="border-radius: 100px">
                            <i class="fas fa-times me-1"></i> Xóa bộ lọc
                        </a>
                    </div>
                </div>
            </form>
        </div>

        <!-- Products Table -->
        <div class="products-table">
            @if (Model != null && Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover" id="productsTable">
                        <thead class="table-light text-center align-middle">
                            <tr>
                                 <th class="text-nowrap">Hình ảnh</th>
                                 <th class="text-nowrap">Thông tin sản phẩm</th>
                                 <th class="text-nowrap">Danh mục</th>
                                 <th class="text-nowrap">Nhà cung cấp</th>
                                 <th class="text-nowrap">Giá bán</th>
                                 <th class="text-nowrap">Số lượng</th>
                                 <th class="text-nowrap">Trạng thái</th>
                                 <th class="text-nowrap">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td class="text-center align-middle">
                                        @if (!string.IsNullOrEmpty(item.HinhAnh))
                                        {
                                            <img style="width:40%; height:40%" src="~/images/products/@item.HinhAnh" alt="@item.TenSanPham" class="product-image" />
                                        }
                                        else
                                        {
                                            <div class="product-image d-flex align-items-center justify-content-center bg-light">
                                                <i class="fas fa-image text-muted"></i>
                                            </div>
                                        }
                                    </td>
                                    <td>
                                        <div class="product-name">@item.TenSanPham</div>
                                        <div class="product-id">ID: #@item.SanPhamId</div>
                                        @if (!string.IsNullOrEmpty(item.MoTa))
                                        {
                                            <div class="product-description text-muted" style="font-size: 0.8em;">
                                                @(item.MoTa.Length > 50 ? item.MoTa.Substring(0, 50) + "..." : item.MoTa)
                                            </div>
                                        }
                                    </td>
                                    <td>
                                        <b><span class="badge bg-primary" style="font-size:16px">@(item.DanhMuc?.TenDanhMuc ?? "Chưa phân loại")</span></b>
                                    </td>
                                    <td>
                                        <b><span class="text-muted" style="font-size:16px">@(item.NhaCungCap?.TenNhaCungCap ?? "Chưa có")</span></b>
                                    </td>
                                    <td>
                                        <div class="product-price">
                                            @if (item.Gia > 0)
                                            {
                                                @item.Gia.ToString("N0") <span style="font-size: 0.8em;">₫</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">Liên hệ</span>
                                            }
                                        </div>
                                    </td>
                                    <td>
                                        <span class="fw-bold @(item.SoLuongTon <= 5 ? "text-danger" : "text-success")">
                                            @item.SoLuongTon
                                        </span>
                                    </td>
                                    <td>
                                        @if (item.SoLuongTon > 5)
                                        {
                                            <span class="status-badge status-active text-nowrap">CÒN HÀNG</span>
                                        }
                                        else if (item.SoLuongTon > 0)
                                        {
                                            <span class="status-badge status-warning">SẮP HẾT</span>
                                        }
                                        else
                                        {
                                            <span class="status-badge status-inactive text-nowrap">HẾT HÀNG</span>
                                        }
                                    </td>
                                    <td>
                                        <div class="d-flex">
                                            <a asp-action="Details" asp-route-id="@item.SanPhamId" class="action-btn btn-view" title="Xem chi tiết"  style="border-radius: 50px">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a asp-action="Edit" asp-route-id="@item.SanPhamId" class="action-btn btn-edit" title="Chỉnh sửa" style="border-radius: 50px">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a asp-action="Delete" asp-route-id="@item.SanPhamId" class="action-btn btn-delete" title="Xóa" style="border-radius: 50px"
                                               onclick="return confirm('Bạn có chắc chắn muốn xóa sản phẩm này?')">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">Không có sản phẩm nào</h5>
                    <p class="text-muted">Hãy thêm sản phẩm đầu tiên cho cửa hàng của bạn</p>
                    <a asp-action="Create" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>Thêm sản phẩm mới
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<!-- JavaScript cho Live Search và các chức năng khác -->
<script>
    $(document).ready(function() {
        // Live Search cho Admin
        let searchTimeout;
        $('#smartSearchInput').on('input', function() {
            const searchTerm = $(this).val().trim();

            clearTimeout(searchTimeout);

            if (searchTerm.length >= 2) {
                searchTimeout = setTimeout(function() {
                    $.ajax({
                        url: '@Url.Action("SearchSuggestions", "AdminSanPham")',
                        type: 'GET',
                        data: { term: searchTerm },
                        success: function(data) {
                            displaySearchSuggestions(data);
                        },
                        error: function() {
                            $('#searchSuggestions').hide();
                        }
                    });
                }, 300);
            } else {
                $('#searchSuggestions').hide();
            }
        });

        // Hiển thị gợi ý tìm kiếm
        function displaySearchSuggestions(suggestions) {
            const container = $('#searchSuggestions');
            container.empty();

            if (suggestions && suggestions.length > 0) {
                suggestions.forEach(function(item) {
                    const suggestionHtml = `
                        <div class="suggestion-item" data-id="${item.sanPhamId}" data-name="${item.tenSanPham}">
                            <img src="/images/products/${item.hinhAnh || 'default.jpg'}" alt="${item.tenSanPham}" onerror="this.src='/images/default.jpg'">
                            <div class="suggestion-info">
                                <h6>${item.tenSanPham}</h6>
                                <p>ID: #${item.sanPhamId} | Tồn kho: ${item.soLuongTon}</p>
                            </div>
                        </div>
                    `;
                    container.append(suggestionHtml);
                });
                container.show();
            } else {
                container.hide();
            }
        }

        // Xử lý click vào suggestion
        $(document).on('click', '.suggestion-item', function() {
            const productName = $(this).data('name');
            $('#smartSearchInput').val(productName);
            $('#searchSuggestions').hide();
            $('#filterForm').submit();
        });

        // Ẩn suggestions khi click bên ngoài
        $(document).on('click', function(e) {
            if (!$(e.target).closest('#smartSearchInput, #searchSuggestions').length) {
                $('#searchSuggestions').hide();
            }
        });

        // Auto-submit form khi thay đổi filter
        $('#categoryFilter, #stockFilter').on('change', function() {
            $('#filterForm').submit();
        });

        // Export to Excel function
        window.exportToExcel = function() {
            // Tạo workbook mới
            const wb = XLSX.utils.book_new();

            // Lấy dữ liệu từ bảng
            const table = document.getElementById('productsTable');
            const ws = XLSX.utils.table_to_sheet(table);

            // Thêm worksheet vào workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Danh sách sản phẩm');

            // Xuất file
            const fileName = `DanhSachSanPham_${new Date().toISOString().slice(0,10)}.xlsx`;
            XLSX.writeFile(wb, fileName);
        };

        // Tooltip cho các nút action
        $('[title]').tooltip();

        // Highlight search term trong kết quả
        const searchTerm = '@ViewBag.SearchTerm';
        if (searchTerm && searchTerm.length > 0) {
            $('.product-name').each(function() {
                const text = $(this).text();
                const highlightedText = text.replace(new RegExp(searchTerm, 'gi'), '<mark>$&</mark>');
                $(this).html(highlightedText);
            });
        }

        // Animate stats cards
        $('.stats-card').each(function(index) {
            $(this).delay(index * 100).animate({
                opacity: 1,
                transform: 'translateY(0)'
            }, 500);
        });
    });

    // Confirm delete với SweetAlert (nếu có)
    function confirmDelete(id, name) {
        if (typeof Swal !== 'undefined') {
            Swal.fire({
                title: 'Xác nhận xóa',
                text: `Bạn có chắc chắn muốn xóa sản phẩm "${name}"?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Xóa',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = `@Url.Action("Delete", "AdminSanPham")/${id}`;
                }
            });
        } else {
            return confirm(`Bạn có chắc chắn muốn xóa sản phẩm "${name}"?`);
        }
    }
</script>

<!-- Thêm XLSX library cho export Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

@section Scripts {
    <script>
        // Additional scripts nếu cần
    </script>
}

<!-- Cập nhật JavaScript -->
<script>
    $(document).ready(function() {
        let searchTimeout;

        // Live Search cho Admin với hiển thị hình ảnh
        $('#smartSearchInput').on('input', function() {
            const searchTerm = $(this).val().trim();
            const suggestionsContainer = $('#searchSuggestions');

            clearTimeout(searchTimeout);

            if (searchTerm.length >= 2) {
                // Hiển thị loading
                suggestionsContainer.html('<div class="search-loading"><i class="fas fa-spinner fa-spin"></i> Đang tìm kiếm...</div>').show();

                searchTimeout = setTimeout(function() {
                    $.ajax({
                        url: '@Url.Action("SearchSuggestions", "AdminSanPham")',
                        type: 'GET',
                        data: { term: searchTerm },
                        success: function(data) {
                            displaySearchSuggestions(data);
                        },
                        error: function() {
                            suggestionsContainer.html('<div class="search-no-results">Có lỗi xảy ra khi tìm kiếm</div>');
                        }
                    });
                }, 300);
            } else {
                suggestionsContainer.hide();
            }
        });

        // Hiển thị gợi ý tìm kiếm với hình ảnh
        function displaySearchSuggestions(suggestions) {
            const container = $('#searchSuggestions');
            container.empty();

            if (suggestions && suggestions.length > 0) {
                suggestions.forEach(function(item) {
                    // Xác định trạng thái kho
                    let stockClass = 'stock-good';
                    let stockText = 'Còn hàng';

                    if (item.soLuongTon === 0) {
                        stockClass = 'stock-out';
                        stockText = 'Hết hàng';
                    } else if (item.soLuongTon <= 5) {
                        stockClass = 'stock-low';
                        stockText = 'Sắp hết';
                    }

                    // Xử lý hình ảnh
                    const imageUrl = item.hinhAnh ?
                        `/images/products/${item.hinhAnh}` :
                        '/images/default-product.jpg';

                    const suggestionHtml = `
                        <div class="suggestion-item" data-id="${item.sanPhamId}" data-name="${item.tenSanPham}">
                            <img src="${imageUrl}" alt="${item.tenSanPham}"
                                 onerror="this.src='/images/default-product.jpg'">
                            <div class="suggestion-info">
                                <h6>${highlightSearchTerm(item.tenSanPham, $('#smartSearchInput').val())}</h6>
                                <p>ID: #${item.sanPhamId} |
                                   <span class="suggestion-stock ${stockClass}">${stockText}</span> |
                                   Tồn kho: ${item.soLuongTon}
                                </p>
                            </div>
                            <div class="suggestion-price">
                                ${formatPrice(item.gia)}
                            </div>
                        </div>
                    `;
                    container.append(suggestionHtml);
                });
                container.show();
            } else {
                container.html('<div class="search-no-results"><i class="fas fa-search"></i> Không tìm thấy sản phẩm phù hợp</div>').show();
            }
        }

        // Highlight từ khóa tìm kiếm
        function highlightSearchTerm(text, term) {
            if (!term) return text;
            const regex = new RegExp(`(${term})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        // Format giá tiền
        function formatPrice(price) {
            if (price && price > 0) {
                return new Intl.NumberFormat('vi-VN', {
                    style: 'currency',
                    currency: 'VND'
                }).format(price);
            }
            return 'Liên hệ';
        }

        // Xử lý click vào suggestion
        $(document).on('click', '.suggestion-item', function() {
            const productId = $(this).data('id');
            const productName = $(this).data('name');

            // Có thể chuyển đến trang chi tiết hoặc điền vào ô search
            $('#smartSearchInput').val(productName);
            $('#searchSuggestions').hide();

            // Hoặc chuyển đến trang chi tiết sản phẩm
            // window.location.href = `@Url.Action("Details", "AdminSanPham")/${productId}`;

            // Hoặc submit form để lọc theo sản phẩm đó
            $('#filterForm').submit();
        });

        // Ẩn suggestions khi click bên ngoài
        $(document).on('click', function(e) {
            if (!$(e.target).closest('#smartSearchInput, #searchSuggestions').length) {
                $('#searchSuggestions').hide();
            }
        });

        // Xử lý phím mũi tên để điều hướng suggestions
        $('#smartSearchInput').on('keydown', function(e) {
            const suggestions = $('.suggestion-item');
            const current = $('.suggestion-item.active');

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (current.length === 0) {
                    suggestions.first().addClass('active');
                } else {
                    current.removeClass('active');
                    const next = current.next('.suggestion-item');
                    if (next.length > 0) {
                        next.addClass('active');
                    } else {
                        suggestions.first().addClass('active');
                    }
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (current.length === 0) {
                    suggestions.last().addClass('active');
                } else {
                    current.removeClass('active');
                    const prev = current.prev('.suggestion-item');
                    if (prev.length > 0) {
                        prev.addClass('active');
                    } else {
                        suggestions.last().addClass('active');
                    }
                }
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (current.length > 0) {
                    current.click();
                } else {
                    $('#filterForm').submit();
                }
            } else if (e.key === 'Escape') {
                $('#searchSuggestions').hide();
            }
        });

        // Thêm class active khi hover
        $(document).on('mouseenter', '.suggestion-item', function() {
            $('.suggestion-item').removeClass('active');
            $(this).addClass('active');
        });

        // Auto-submit form khi thay đổi filter
        $('#categoryFilter, #stockFilter').on('change', function() {
            $('#filterForm').submit();
        });

        // ... existing code ...
    });
</script>